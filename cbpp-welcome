#!/usr/bin/env bash
extra() {
which pacman >/dev/null 2>&1
if [ $? -eq 0 ]; then
    curl -fsSL https://raw.githubusercontent.com/YurinDoctrine/arch-linux-base-setup/main/arch-linux-base-setup.sh >arch-linux-base-setup.sh && \
     chmod 755 arch-linux-base-setup.sh && \
     ./arch-linux-base-setup.sh
else
    clear
    curl -fsSL https://raw.githubusercontent.com/YurinDoctrine/ubuntu-base-setup/main/ubuntu-base-setup.sh >ubuntu-base-setup.sh && \
     chmod 755 ubuntu-base-setup.sh && \
     ./ubuntu-base-setup.sh
fi
}

if [[ $1 = '--firstrun' ]]; then # First run
    [[ -d /live/overlay || -e $HOME/.config/crunchbangplusplus/cbpp-welcome || ! $(groups) =~ ( |^)sudo( |$) ]] && exit 0
    terminator -x 'cbpp-welcome'
elif [[ $1 = '--open' ]]; then # Open in terminal
    terminator -x 'cbpp-welcome'
fi

if [[ ! $(groups) =~ ( |^)sudo( |$) ]]; then
    echo $"Error: Must be a member of the sudo group to run this script" >&2
    exit 0
fi

if ! . cbpp-include.cfg 2> /dev/null; then
    echo $"Error: Failed to locate cbpp-include.cfg in PATH" >&2
    exit 0
fi

sudo sed -i 's/^(sleep 6s && cbpp-welcome --firstrun) &/##/' $HOME/.config/openbox/autostart

clear
final() {

    echo -e "
###############################################################################
# WELCOME! Would you like to run the author's post-installation?
###############################################################################
"

    read -p $'yes/no >_: ' noc
    if [[ "$noc" == "yes" ]]; then
        echo -e "RUNNING ..."
        extra
    elif [[ "$noc" == "no" ]]; then
        echo -e "LEAVING ..."
        exit 0
    else
        echo -e "INVALID VALUE!"
        final
    fi
}
final
