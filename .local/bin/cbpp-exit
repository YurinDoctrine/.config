#!/usr/bin/env bash

if ! . cbpp-include.cfg 2>/dev/null; then
	echo '  Failed to locate cbpp-include.cfg in PATH' >&2
	exit 1
fi

if [[ $1 = '--dialog' ]]; then

	dialog=$(echo -e "[ Cancel ]\nLogout\nReboot\nShutdown\nSuspend" | dmenu -i -b -nb '#151617' -nf '#d8d8d8' -sb '#d8d8d8' -sf '#151617')
	if [[ $dialog = "Logout" ]]; then
		openbox --exit
	elif [[ $dialog = "Reboot" ]]; then
		$(xterm -e "doas reboot")
	elif [[ $dialog = "Shutdown" ]]; then
		$(xterm -e "doas poweroff")
	elif [[ $dialog = "Suspend" ]]; then
		$(xterm -e "slock | xset dpms force suspend")
	fi
else
	# Output Openbox menu
	menuStart
	menuItem 'Logout' 'openbox --exit'
	menuItem 'Reboot' 'xterm -e "doas reboot"'
	menuItem 'Shutdown' 'xterm -e "doas poweroff"'
	menuItem 'Suspend' 'xterm -e "slock | xset dpms force suspend"'
	menuEnd
fi
exit 0
