#!/usr/bin/sh
# cbpp-xcompmgr
# Openbox Pipe Menu for use with xcompmgr compositor
# Written for CrunchBang Linux <http://crunchbang.org/>
# by Philip Newborough <corenominal@corenominal.org>
# Ported to #!++ <https://crunchbangplusplus.org>
# by Ben Young <computermouth@crunchbangplusplus.org>

if ! . cbpp-include.cfg 2>/dev/null; then
    echo '  Failed to locate cbpp-include.cfg in PATH' >&2
    exit 1
fi

EXECXCOMP='xcompmgr -a'
if [[ $1 = '--start' || $1 = '--restart' ]]; then # Toggle compositing with xcompmgr.
    if ! pidof xcompmgr >/dev/null; then
        $EXECXCOMP &
    else
        killall -HUP xcompmgr &&
            $EXECXCOMP &
    fi
else
    # Output Openbox menu
    menuStart
    if ! pidof xcompmgr >/dev/null; then
        menuItem 'Enable Compositing' 'cbpp-compositor --start'
    else
        menuItem 'Restart Compositing' 'cbpp-compositor --restart'
    fi
    menuEnd
fi
exit 0
